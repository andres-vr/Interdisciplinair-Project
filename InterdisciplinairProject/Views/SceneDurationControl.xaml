<UserControl x:Class="InterdisciplinairProject.Views.SceneDurationControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:InterdisciplinairProject.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="30" d:DesignWidth="50">

    <UserControl.Resources>
        <converters:MillisecondsToSecondsConverter x:Key="MsToSecondsConverter"/>
    </UserControl.Resources>

    <Border Background="White" 
            BorderBrush="#E0E0E0" 
            BorderThickness="1" 
            CornerRadius="10"
            Height="24"
            Width="64">
        <Border.Effect>
            <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="4" ShadowDepth="1" Direction="270"/>
        </Border.Effect>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBox Grid.Column="0"
                     Text="{Binding TotalDuration, Mode=TwoWay, UpdateSourceTrigger=LostFocus, Converter={StaticResource MsToSecondsConverter}}"
                     HorizontalAlignment="Stretch"
                     VerticalAlignment="Center"
                     HorizontalContentAlignment="Center"
                     VerticalContentAlignment="Center"
                     FontSize="11"
                     FontWeight="SemiBold"
                     Foreground="#455A64"
                     Background="Transparent"
                     BorderThickness="0"
                     Padding="0"/>
            
            <TextBlock Grid.Column="1"
                       Text="s"
                       FontSize="10"
                       FontWeight="Normal"
                       Foreground="#90A4AE"
                       VerticalAlignment="Center"
                       Margin="0,0,4,0"/>
            
            <Button Grid.Column="2"
                    x:Name="InfoButton"
                    Width="16"
                    Height="16"
                    Margin="0,0,4,0"
                    Background="Transparent"
                    BorderThickness="0"
                    Cursor="Hand"
                    VerticalAlignment="Center">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                Padding="0">
                            <TextBlock Text="â„¹" 
                                       FontSize="12" 
                                       FontWeight="Bold"
                                       Foreground="#2196F3"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#E3F2FD"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Button.Template>
            </Button>
            
            <Popup x:Name="DurationPopup"
                   PlacementTarget="{Binding ElementName=InfoButton}"
                   Placement="Bottom"
                   StaysOpen="False"
                   AllowsTransparency="True">
                <Border Background="White"
                        BorderBrush="#BDBDBD"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" Opacity="0.2" BlurRadius="8" ShadowDepth="2" Direction="270"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="Total Duration (seconds)" FontWeight="Bold" Margin="0,0,0,8" FontSize="12"/>
                        <TextBlock Margin="0,0,0,4">
                            <Run Text="Fade In: "/>
                            <Run Text="{Binding SceneModel.ShowScene.FadeInMs, Mode=OneWay, Converter={StaticResource MsToSecondsConverter}, StringFormat={}{0:F2}}" FontWeight="SemiBold"/>
                            <Run Text="s"/>
                        </TextBlock>
                        <TextBlock Margin="0,0,0,4">
                            <Run Text="Hold: "/>
                            <Run Text="{Binding SceneModel.HoldDurationMs, Mode=OneWay, Converter={StaticResource MsToSecondsConverter}, StringFormat={}{0:F2}}" FontWeight="SemiBold"/>
                            <Run Text="s"/>
                        </TextBlock>
                        <TextBlock Margin="0,0,0,4">
                            <Run Text="Fade Out: "/>
                            <Run Text="{Binding SceneModel.ShowScene.FadeOutMs, Mode=OneWay, Converter={StaticResource MsToSecondsConverter}, StringFormat={}{0:F2}}" FontWeight="SemiBold"/>
                            <Run Text="s"/>
                        </TextBlock>
                        <Separator Margin="0,8,0,4"/>
                        <CheckBox Content="Wait for TAB" 
                                  IsChecked="{Binding SceneModel.WaitForTab, Mode=TwoWay}" 
                                  Margin="0,4,0,4"/>
                        <Separator Margin="0,4,0,8"/>
                        <TextBlock Text="Minimum: FadeIn + FadeOut" FontStyle="Italic" FontSize="10" Foreground="Gray"/>
                    </StackPanel>
                </Border>
            </Popup>
        </Grid>
    </Border>
</UserControl>
